maintainer="Mitchell Scott <mitchell@scottlabs.io>"
pkgname=vellum-hosts
pkgver=1.0.0
pkgrel=0
upstream_author="vellum-dev"
category="utilities"
pkgdesc="Adds packages.vellum.delivery IP addresses to /etc/hosts"
url="https://github.com/vellum-dev/vellum"
arch="noarch"
license="MIT"
depends="mount-utils"
options="!check !fhs !strip !tracedeps"
source="
update-hosts.sh
LICENSE
"

package() {
	local install_dir="$pkgdir/home/root/.local/share/vellum-hosts"
	mkdir -p "$install_dir"

	install -Dm755 "$srcdir/update-hosts.sh" "$install_dir/update-hosts.sh"

	mkdir -p "$pkgdir/home/root/.vellum/licenses/$pkgname"
	install -Dm644 "$srcdir/LICENSE" \
		"$pkgdir/home/root/.vellum/licenses/$pkgname/LICENSE"
	echo "https://github.com/$upstream_author/vellum" > \
		"$pkgdir/home/root/.vellum/licenses/$pkgname/SOURCES"

	install -Dm755 "$startdir/$pkgname.post-os-upgrade" \
		"$pkgdir/home/root/.vellum/hooks/post-os-upgrade/$pkgname"
}

postinstall(){
	VELLUM_BIN="${VELLUM_BIN:-/home/root/.vellum/bin}"
	"$VELLUM_BIN/mount-rw"
	/home/root/.local/share/vellum-hosts/update-hosts.sh add
	"$VELLUM_BIN/mount-restore"
}

postupgrade(){
	VELLUM_BIN="${VELLUM_BIN:-/home/root/.vellum/bin}"
	"$VELLUM_BIN/mount-rw"
	/home/root/.local/share/vellum-hosts/update-hosts.sh add
	"$VELLUM_BIN/mount-restore"
}

postosupgrade(){
	/home/root/.local/share/vellum-hosts/update-hosts.sh add
}

predeinstall(){
	VELLUM_BIN="${VELLUM_BIN:-/home/root/.vellum/bin}"
	"$VELLUM_BIN/mount-rw"
	/home/root/.local/share/vellum-hosts/update-hosts.sh remove
	"$VELLUM_BIN/mount-restore"
}

sha512sums="
949bc2a1fe273a655de772fdd5b6fc557c025c27c45fb3cf19e2b8cad0337b7a5ad08a2300232904a0b22061583aeb38b3f21a7a56e9eb747dfa1c0d9740b398  update-hosts.sh
b7a86c9fc7a740ff680037b0e6b646ccd70e4e74fef78669b8ba92e18b873e4673fbba064272c595d13bc016288cd4a0532cd974534b7fef43a5b065f24add95  LICENSE
"
