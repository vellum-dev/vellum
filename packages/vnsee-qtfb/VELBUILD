maintainer="Interloper <45214659+0xdeb7ef@users.noreply.github.com>"
pkgname=vnsee-qtfb
pkgver=1.1.0
pkgrel=2
upstream_author="khyryra"
category="apps"
pkgdesc="VNC client for the reMarkable tablet allowing you to use the device as a second screen"
url="https://github.com/khyryra/vnsee-qtfb"
license="GPL-3.0"
arch="aarch64 armv7"
depends="appload"
replaces="vnsee-qtfb-rm1 vnsee-qtfb-rm2 vnsee-qtfb-rmpp vnsee-qtfb-rmppm"
options="!check !fhs !strip !tracedeps"

source="
https://github.com/khyryra/vnsee-qtfb/releases/download/v$pkgver/vnsee-rm2.zip
https://github.com/khyryra/vnsee-qtfb/releases/download/v$pkgver/vnsee-ferrari.zip
https://raw.githubusercontent.com/khyryra/vnsee-qtfb/master/LICENSE.md
"

unpack() {
	case "$CARCH" in
		armv7) unzip -o "$srcdir"/vnsee-rm2.zip -d "$srcdir" ;;
		aarch64) unzip -o "$srcdir"/vnsee-ferrari.zip -d "$srcdir" ;;
	esac
}

package() {
	install -d "$pkgdir"/home/root/xovi/exthome/appload

	for n in "" -0 -1 -2 -3; do
		cp -r "$srcdir"/vnsee$n \
			"$pkgdir"/home/root/xovi/exthome/appload/vnsee$n
	done

	install -Dm644 "$srcdir"/LICENSE.md \
		"$pkgdir"/home/root/.vellum/licenses/$pkgname/LICENSE
	echo "https://github.com/khyryra/vnsee-qtfb/archive/v$pkgver.tar.gz" > \
		"$pkgdir"/home/root/.vellum/licenses/$pkgname/SOURCES
}

postinstall(){
	echo ""
	echo "================================================================="
	echo "  NOTE: You have to update your connection parameters in"
	echo "   /home/root/xovi/exthome/appload/vnsee-X/external.manifest.json"
	echo "   Where X is the different vnsee display modes."
	echo "================================================================="
	echo ""
}

postupgrade(){
	echo ""
	echo "================================================================="
	echo "  NOTE: You have to update your connection parameters in"
	echo "   /home/root/xovi/exthome/appload/vnsee-X/external.manifest.json"
	echo "   Where X is the different vnsee display modes."
	echo "================================================================="
	echo ""
}

postdeinstall(){
	if [ "$VELLUM_PURGE" = "1" ]; then
		rm -rf \
			/home/root/xovi/exthome/appload/vnsee \
			/home/root/xovi/exthome/appload/vnsee-0 \
			/home/root/xovi/exthome/appload/vnsee-1 \
			/home/root/xovi/exthome/appload/vnsee-2 \
			/home/root/xovi/exthome/appload/vnsee-3
	fi
}

sha512sums="
12372589ae6e220b9fd80323889797d932c41062a45ffa960e07ecfd81ded97125fbf6aee87ee7917a0b97cb3898a5658615b3bd4478a6c736803e7fe1ca512f  vnsee-rm2.zip
3ca1a84e4e42c06219eecb456963e5fad3b135dfe41bf9cea3d321f9347d8a19f20868ec0aabf120431135ceb8fe04f011ddcbda3fdc8be449224e33523e1d5e  vnsee-ferrari.zip
d361e5e8201481c6346ee6a886592c51265112be550d5224f1a7a6e116255c2f1ab8788df579d9b8372ed7bfd19bac4b6e70e00b472642966ab5b319b99a2686  LICENSE.md
"
