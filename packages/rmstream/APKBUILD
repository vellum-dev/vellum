maintainer="Mitchell Scott <mitchell@scottlabs.io>"
pkgname=rmstream
pkgver=0.1.1
pkgrel=0
_upstream_author="asivery"
_category="apps"
pkgdesc="Stream your reMarkable's screen to any device on the local network via HTTP"
url="https://github.com/asivery/appload-rmstream"
arch="aarch64 armv7"
license="GPL-3.0"
depends="appload framebuffer-spy"
install="$pkgname.post-install $pkgname.post-deinstall"
options="!check !fhs !strip !tracedeps"

source="
$pkgname-$pkgver-aarch64.zip::https://github.com/asivery/appload-rmstream/releases/download/v$pkgver/rmstream-aarch64.zip
$pkgname-$pkgver-armv7.zip::https://github.com/asivery/appload-rmstream/releases/download/v$pkgver/rmstream-arm32.zip
LICENSE::https://raw.githubusercontent.com/asivery/appload-rmstream/master/LICENSE
"

sha512sums="
3e370b80beec32a83b3defb6a0be149d76fcb2e8ad827e695ab5a30930a4cb7a9be16db499123392f2338d942a26ff767585a6e3686c5b9455e71f507655aca1  rmstream-0.1.1-aarch64.zip
ae2d9b8120945e5b27aef430078afbf84840a874ca4452c436bff7d8498a7909329e1d030003856c19a2865f35bb2c030a0f21dba27cc53c42e8ef012deb5579  rmstream-0.1.1-armv7.zip
d361e5e8201481c6346ee6a886592c51265112be550d5224f1a7a6e116255c2f1ab8788df579d9b8372ed7bfd19bac4b6e70e00b472642966ab5b319b99a2686  LICENSE
"

prepare() {
	default_prepare
	cd "$srcdir"
	case "$CARCH" in
		aarch64) unzip -o "$pkgname-$pkgver-aarch64.zip" ;;
		armv7|armhf) unzip -o "$pkgname-$pkgver-armv7.zip" ;;
	esac
}

package() {
	mkdir -p "$pkgdir/home/root/xovi/exthome/appload"
	case "$CARCH" in
		aarch64) cp -r "$srcdir/rmstream-aarch64" "$pkgdir/home/root/xovi/exthome/appload/rmstream" ;;
		armv7|armhf) cp -r "$srcdir/rmstream-arm32" "$pkgdir/home/root/xovi/exthome/appload/rmstream" ;;
	esac

	install -Dm644 "$srcdir/LICENSE" \
		"$pkgdir/home/root/.vellum/licenses/$pkgname/LICENSE"
	echo "https://github.com/asivery/appload-rmstream/archive/v$pkgver.tar.gz" > \
		"$pkgdir/home/root/.vellum/licenses/$pkgname/SOURCES"
}
