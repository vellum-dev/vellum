maintainer="Interloper <45214659+0xdeb7ef@users.noreply.github.com>"
pkgname=zig
pkgver=0.15.2
pkgrel=0
_upstream_author="ziglang"
_category="utilities"
pkgdesc="A general-purpose programming language and toolchain for maintaining robust, optimal and reusable software"
url="https://ziglang.org"
arch="aarch64 armv7"
license="MIT"
options="!check !fhs !strip !tracedeps"
subpackages="$pkgname-doc"

source="
https://ziglang.org/download/$pkgver/zig-arm-linux-$pkgver.tar.xz
https://ziglang.org/download/$pkgver/zig-aarch64-linux-$pkgver.tar.xz
"

unpack() {
	if [ -z "$force" ]; then
			verify
			initdcheck
	fi

	mkdir -p "$srcdir"
	case "$CARCH" in
			aarch64) _arch="aarch64" ;;
			armv7 | armhf) _arch="arm" ;;
	esac
	_tar="$SRCDEST/zig-$_arch-linux-$pkgver.tar.xz"

	msg "Unpacking $_tar..."
	unxz -c "$_tar" | tar -C "$srcdir" -x
	mv "$srcdir/zig-$_arch-linux-$pkgver" "$srcdir/zig"
}

package() {
	cd "$srcdir/zig"

	install -Dm644 LICENSE \
		"$pkgdir/home/root/.vellum/licenses/$pkgname/LICENSE"

	mkdir -p "$pkgdir/home/root/.vellum/lib"
	cp -r "lib" "$pkgdir/home/root/.vellum/lib/$pkgname"

	install -Dm744 zig "$pkgdir/home/root/.vellum/bin/$pkgname"

	echo "https://ziglang.org/download/$pkgver/zig-$pkgver.tar.xz" > \
		"$pkgdir/home/root/.vellum/licenses/$pkgname/SOURCES"
}

doc() {
	pkgdesc="Zig documentation (language reference)"
	cd "$srcdir/zig"

	mkdir -p "$subpkgdir/home/root/.vellum/share/doc"
	cp -r "doc" "$subpkgdir/home/root/.vellum/share/doc/$pkgname"
	install -Dm644 README.md "$subpkgdir/home/root/.vellum/share/doc/$pkgname/README.md"
}

sha512sums="
03456c940adebf23b050b66fec3e7d7c9bf70b956fa425992ce155e713b1ea1ac6b616f22b0334ca3d62655209c639b020ea29dda1a75aa5fd200e93e1775c18  zig-arm-linux-0.15.2.tar.xz
32e406bc5eebd2f41fb4fa8a04e76a4bdc5fcf44dcfbdc7242e063796ba5fccab6734653ca4108576b4557d85c8e984d40431dc707c5699a464dd19ac04aaf1d  zig-aarch64-linux-0.15.2.tar.xz
"
