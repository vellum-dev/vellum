maintainer="Mitchell Scott <mitchell@scottlabs.io>"
pkgname=tripletap
pkgver=1.0.0
pkgrel=1
_upstream_author="rmitchellscott"
_category="utilities"
pkgdesc="Start xovi by triple-pressing the power button"
url="https://github.com/rmitchellscott/xovi-tripletap"
arch="aarch64 armv7"
license="MIT"
depends="xovi mount-utils"
install="$pkgname.post-install $pkgname.pre-upgrade $pkgname.post-upgrade $pkgname.pre-deinstall"
source="
$pkgname-$pkgver.tar.gz::https://github.com/rmitchellscott/xovi-tripletap/archive/v$pkgver.tar.gz
LICENSE::https://raw.githubusercontent.com/rmitchellscott/xovi-tripletap/main/LICENSE
"
builddir="$srcdir/xovi-tripletap-$pkgver"
options="!check !fhs !strip !tracedeps"

package() {
	local install_dir="$pkgdir/home/root/xovi-tripletap"
	mkdir -p "$install_dir"

	case "$CARCH" in
		aarch64)
			install -Dm755 evtest.arm64 "$install_dir/evtest"
			;;
		armv7|armhf)
			install -Dm755 evtest.arm32 "$install_dir/evtest"
			;;
	esac

	install -Dm755 main.sh "$install_dir/main.sh"
	install -Dm755 enable.sh "$install_dir/enable.sh"
	install -Dm755 uninstall.sh "$install_dir/uninstall.sh"
	install -Dm755 version-switcher.sh "$install_dir/version-switcher.sh"
	install -Dm755 init-version-switching.sh "$install_dir/init-version-switching.sh"
	install -Dm755 prepare-new-version.sh "$install_dir/prepare-new-version.sh"
	install -Dm755 disable-version-switching.sh "$install_dir/disable-version-switching.sh"
	install -Dm755 press-and-hold.sh "$install_dir/press-and-hold.sh"

	install -Dm644 config.default "$install_dir/config.default"
	install -Dm755 migrate-to-config.sh "$install_dir/migrate-to-config.sh"

	install -Dm644 xovi-tripletap.service "$install_dir/xovi-tripletap.service"

	echo "$pkgver" > "$install_dir/version.txt"

	install -Dm644 "$srcdir/LICENSE" \
		"$pkgdir/home/root/.vellum/licenses/$pkgname/LICENSE"
	echo "https://github.com/rmitchellscott/xovi-tripletap/archive/v$pkgver.tar.gz" > \
		"$pkgdir/home/root/.vellum/licenses/$pkgname/SOURCES"

	install -Dm755 "$startdir/$pkgname.post-os-upgrade" \
		"$pkgdir/home/root/.vellum/hooks/post-os-upgrade/$pkgname"
}
sha512sums="
0ae119c57a2829877fb0ed7e82eea23938e1ad97d226b428e1e18b7f074ad3f35e0be520c2fc1d47f82151c0975bf54b4adc40c5eae9af68726633effed17b2f  tripletap-1.0.0.tar.gz
b7a86c9fc7a740ff680037b0e6b646ccd70e4e74fef78669b8ba92e18b873e4673fbba064272c595d13bc016288cd4a0532cd974534b7fef43a5b065f24add95  LICENSE
"
