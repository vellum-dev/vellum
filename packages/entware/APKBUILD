maintainer="Mitchell Scott <mitchell@scottlabs.io>"
pkgname=entware
pkgver=1.0.0
pkgrel=0
pkgdesc="Entware software repository for reMarkable tablets"
_upstream_author="Entware"
_category="utilities"
url="https://entware.net/"
arch="aarch64 armv7"
license="GPL-2.0"
depends="mount-utils"
install="$pkgname.post-install $pkgname.post-upgrade $pkgname.pre-deinstall $pkgname.post-deinstall"
options="!check !fhs !strip !tracedeps"
source="
install-entware.sh
reenable-entware.sh
COPYING::https://raw.githubusercontent.com/Entware/Entware/master/COPYING
opkg.aarch64::http://bin.entware.net/aarch64-k3.10/installer/opkg
opkg.armv7::http://bin.entware.net/armv7sf-k3.2/installer/opkg
opkg.conf.aarch64::http://bin.entware.net/aarch64-k3.10/installer/opkg.conf
opkg.conf.armv7::http://bin.entware.net/armv7sf-k3.2/installer/opkg.conf
ld-2.27.so.aarch64::http://bin.entware.net/aarch64-k3.10/installer/ld-2.27.so
ld-2.27.so.armv7::http://bin.entware.net/armv7sf-k3.2/installer/ld-2.27.so
libc-2.27.so.aarch64::http://bin.entware.net/aarch64-k3.10/installer/libc-2.27.so
libc-2.27.so.armv7::http://bin.entware.net/armv7sf-k3.2/installer/libc-2.27.so
libgcc_s.so.1.aarch64::http://bin.entware.net/aarch64-k3.10/installer/libgcc_s.so.1
libgcc_s.so.1.armv7::http://bin.entware.net/armv7sf-k3.2/installer/libgcc_s.so.1
libpthread-2.27.so.aarch64::http://bin.entware.net/aarch64-k3.10/installer/libpthread-2.27.so
libpthread-2.27.so.armv7::http://bin.entware.net/armv7sf-k3.2/installer/libpthread-2.27.so
"

package() {
	local install_dir="$pkgdir/home/root/.local/share/entware"
	local bin_dir="$install_dir/bin"
	local lib_dir="$install_dir/lib"
	mkdir -p "$install_dir" "$bin_dir" "$lib_dir"

	install -Dm755 "$srcdir/install-entware.sh" "$install_dir/install-entware.sh"
	install -Dm755 "$srcdir/reenable-entware.sh" "$install_dir/reenable-entware.sh"

	case "$CARCH" in
		aarch64)
			install -Dm755 "$srcdir/opkg.aarch64" "$bin_dir/opkg"
			install -Dm644 "$srcdir/opkg.conf.aarch64" "$install_dir/opkg.conf"
			install -Dm755 "$srcdir/ld-2.27.so.aarch64" "$lib_dir/ld-2.27.so"
			install -Dm755 "$srcdir/libc-2.27.so.aarch64" "$lib_dir/libc-2.27.so"
			install -Dm755 "$srcdir/libgcc_s.so.1.aarch64" "$lib_dir/libgcc_s.so.1"
			install -Dm755 "$srcdir/libpthread-2.27.so.aarch64" "$lib_dir/libpthread-2.27.so"
			;;
		armv7|armhf)
			install -Dm755 "$srcdir/opkg.armv7" "$bin_dir/opkg"
			install -Dm644 "$srcdir/opkg.conf.armv7" "$install_dir/opkg.conf"
			install -Dm755 "$srcdir/ld-2.27.so.armv7" "$lib_dir/ld-2.27.so"
			install -Dm755 "$srcdir/libc-2.27.so.armv7" "$lib_dir/libc-2.27.so"
			install -Dm755 "$srcdir/libgcc_s.so.1.armv7" "$lib_dir/libgcc_s.so.1"
			install -Dm755 "$srcdir/libpthread-2.27.so.armv7" "$lib_dir/libpthread-2.27.so"
			;;
	esac

	install -Dm644 "$srcdir/COPYING" \
		"$pkgdir/home/root/.vellum/licenses/$pkgname/COPYING"
	echo "https://github.com/$_upstream_author/Entware" > \
		"$pkgdir/home/root/.vellum/licenses/$pkgname/SOURCES"

	install -Dm755 "$startdir/$pkgname.post-os-upgrade" \
		"$pkgdir/home/root/.vellum/hooks/post-os-upgrade/$pkgname"
}
sha512sums="
0250a53df41afc120521bec337641319ea439871fde401cf9fa70fad228586a96ba8a4ed6d5293b0e4e013f19421dc152f3b5123d61bfa9104defb9401481ebe  install-entware.sh
26c1e0b37f7acce03213d5c5dff0aa7ff0d9311a0fe56f11fc6ee2507438f3adfc4be7904164e4416eda1453897bd469e954332460283aaabb2fd7b9297fd061  reenable-entware.sh
0d3e8dbc7f61ae54bbdfd0a793b530d65747b51a954fba25c91f91390f4909d9c39d925af6827f82ee14aea8d9611eb9e0ab96e3d74cff2410a1955de3d0585e  COPYING
7aec21488b31e74b91ebedb832f57ac1f31496670f130010475d50a91b1cf7d8e5ff39ae8980c763630af6b6d14e7b5c70c99d00455b7b0e105bbc8c6177036a  opkg.aarch64
bf1a62b45ad836ba0577d269ae13ff6bdd78f160be0133b8893f8f5b0b3281fea165224f75550cda3355fc4f633d2e5981d66f93ae2cee13e9d056bccf9d55d7  opkg.armv7
9afcd85088921d208b9aec6155f99e0d6542e8ecc06d20b8edc58429401f822e52c1d1de2165148d06078664e7d07ed2fe033a0617fb7b650d4cc42e61dcbc6e  opkg.conf.aarch64
86850328a7dedf096ed73585f42d3e2838d2c023bf41afdd85ea6a34216be1e6b92108fd094ce73899782eddb1be6489e5feb8ef1a41c750f44faaf19529a001  opkg.conf.armv7
6b776cc7de1a1235a1d812e467baea4e0eb13a09d2edd5104ed5f7b19b8c2f2ffcea5e45625eca7612ff0a007bafd1a5d260cc2c389a1c9cf25c8c7d80d1b7ba  ld-2.27.so.aarch64
98a5f75e06d799a4459f9667ff3e0a9f917755378b23ae41a8e825ca15c4e8927bc28d4fd01d44664a9ee94c0f14ef92ae94608294db07ceefcd64ffb254db96  ld-2.27.so.armv7
c3ba715536a21da229b5a2f9f9d990f64dc0673eb2d1b45238b56f7d63ad07fa64d54daf1ce910fbe40f511b040cbd9dccf007f29bc33974ba99bf6b0fec9195  libc-2.27.so.aarch64
c5567e2642fb6e48da14f49a753f24cad9c320c67d2535e7e0052dc4595bcd61ae0082afa7e91779dbdef0b04f8751c74281c649679945816e574e115b2774da  libc-2.27.so.armv7
d219861a452cfb3087f425f025e55786a9adb2396b24693008ef24abf645e834e442f3297a6c2620afc8b345993de9cc22999749248f1bee3d10d618f8109519  libgcc_s.so.1.aarch64
1ca93706f36d60d15dd6cdc163f5f22e8c0d7fc86308bf29b7b70ae172f4af9a55ad1dc6e3dfa61a2187674e308d3b28ab874531ed79292735f1e9ee85175aa3  libgcc_s.so.1.armv7
3dee9c21ab152ed9da899d57903284faa28b078e823167870187bf510af3fd4a35f8034e0e8e621ec1dee978a10ee3fdbbaa43acca9d1a7b19b6b54369e9df1f  libpthread-2.27.so.aarch64
442d471033a26d67b2286dbcf409dd280f54703faa488833c477536a3fca431e0ed12d9601aa84c4675e99915612d791b020448f9fbb04b4b8a1c620334a7cd2  libpthread-2.27.so.armv7
"
